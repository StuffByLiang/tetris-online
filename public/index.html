<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
    </style>
  </head>
  <body>
    <canvas id="holdCanvas" width="98" height="98" style="float: left; margin-right: 10px;"></canvas>
    <canvas id="boardCanvas" width="240" height="428" style="float: left; margin-right: 10px;"></canvas>
    <canvas id="playerIncomingCanvas" width="4" height="530" style="float: left;"></canvas>
    <canvas id="queueCanvas" width="98" height="362" style="float: left;"></canvas>

    <script src="/js/client.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();
      var id;

      socket.on('connect', function() {
        id = socket.id;
      });

      // socket.on('newPlayer', function(playerData){
      //   console.log(playerData);
      //   update(playerData);
      // });

      socket.on('update', function(data){
        draw.clearCanvas(draw.boardCanvas);
        draw.drawGrid();

        console.log(data);
        //ghost piece
        var myRotations = data.piece.rotation.split('|');
        draw.clearCanvas(draw.boardCanvas);
        for(var i = 0; i <= 3; i++) {
            var xx, yy, coordinates;

            coordinates = myRotations[i].split(',');
            xx = Number(coordinates[0]); //x pos of the block
            yy = Number(coordinates[1]); //y pos of the block

            draw.makeBlock(1 + (data.piece.x) * 24, 1 + (data.ghost.y) * 24, xx, yy, data.ghost.color, draw.boardCanvas);
        }


        //draw pieces
        myRotations = data.piece.rotation.split('|');
        for(var i = 0; i <= 3; i++) {
            var xx, yy, coordinates;

            coordinates = myRotations[i].split(',');
            xx = Number(coordinates[0]); //x pos of the block
            yy = Number(coordinates[1]); //y pos of the block

            color = draw.getPieceColor(data.piece.color);

            draw.makeBlock(1 + (data.piece.x) * 24, 1 + (data.piece.y) * 24, xx, yy, color, draw.boardCanvas);
        }

        boardPosition[data.id] = data.boardPosition;
        draw.drawBoard();

      });
      var boardPosition = [];

      function update(playerData) {
        draw.clearCanvas(draw.boardCanvas);
        draw.drawGrid();
        boardPosition[playerData.id] = playerData.boardPosition;
        draw.drawBoard();
      }

    </script>
  </body>
</html>
