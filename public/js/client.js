!function(e){var t={};function a(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(i,r,function(t){return e[t]}.bind(null,r));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t){function a(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentBag=0,this.currentPiece=0,this.currentPieceName="",this.canHold=!0,this.currentHoldPiece="",this.firstHold=!1,this.b2b=!1,this.tspinRotate=!1,this.combo=0,this.linesSent=0,this.incoming=[],this.boardPosition=[[],[]],this.pressed={},this.begin=!1,this.startTime=0,this.linesSentRecord="",this.boardPositionRecord="";for(var t=-1;t<=10;t++){this.boardPosition[t]=[];for(var a=-1;a<=22;a++)this.boardPosition[t][a]=0,-1!=t&&10!=t&&-1!=a&&22!=a||(this.boardPosition[t][a]=1)}}var t,i,r;return t=e,(i=[{key:"isPressed",value:function(e){return void 0===this.pressed[e]}},{key:"addToIncoming",value:function(e){this.incoming.push(e)}},{key:"getTotalIncoming",value:function(){if(void 0!==this.incoming.length){var e=0,t=!0,a=!1,i=void 0;try{for(var r,o=this.incoming[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){e+=r.value}}catch(e){a=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}return e}}},{key:"reduceGarbage",value:function(e){for(var t=game.player,a=0;a<t.incoming.length;a++)e>t.incoming[a]?(e-=t.incoming[a],t.incoming.shift(),a--):e<t.incoming[a]&&(t.incoming[a]-=e,e=0);return e}}])&&a(t.prototype,i),r&&a(t,r),e}();e.exports=i},function(e,t,a){e.exports=a(15)},function(e,t){window.settings={arr:0,das:120,gravity:10}},function(e,t,a){function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=a(4),o=(a(6),a(0)),n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.io=t,this.player=new o,this.bag=[]}var t,a,n;return t=e,(a=[{key:"start",value:function(){var e=this.player;!this.checkLoss()&&e.begin||(e.begin=!0,e.piece&&(clearInterval(e.piece.interval),e.piece=null),e.startTime=(new Date).getTime(),this.spawnPiece())}},{key:"checkLoss",value:function(){for(var e=this.player,t=!1,a=0;a<=1;a++)for(var i=3;i<=6;i++)0!=e.boardPosition[i][a]&&(t=!0);return t}},{key:"moveLeft",value:function(){var e=this.player;e.canMoveLeft=setTimeout(this.doMoveLeft.bind(this),settings.das),e.piece.checkCollision(2)||(e.piece.rotationLimit++,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,e.tspinRotate=!1,e.piece.lockdown(),e.piece.x--,e.piece.update()),delete e.pressed.moveRight}},{key:"doMoveLeft",value:function(){var e=this.player;e.pressed.moveLeft>0&&(e.piece.checkCollision(2)||(e.tspinRotate=!1,e.piece.lockdown(),e.piece.x--,e.piece.update()),e.canMoveLeft=setTimeout(this.doMoveLeft.bind(this),settings.arr))}},{key:"rotateRight",value:function(){var e=this.player;e.piece.canRotate(1)&&(e.piece.rotationLimit++,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,e.piece.angle++,e.piece.angle>3&&(e.piece.angle=0),e.tspinRotate=!0,e.piece.lockdown(),e.piece.update())}},{key:"moveRight",value:function(){var e=this.player;e.canMoveRight=setTimeout(this.doMoveRight.bind(this),settings.das),e.piece.checkCollision(0)||(e.piece.rotationLimit++,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,e.tspinRotate=!1,e.piece.lockdown(),e.piece.x++,e.piece.update()),delete e.pressed.moveLeft}},{key:"doMoveRight",value:function(){var e=this.player;e.pressed.moveRight>0&&(e.piece.checkCollision(0)||(e.tspinRotate=!1,e.piece.lockdown(),e.piece.x++,e.piece.update()),e.canMoveRight=setTimeout(this.doMoveRight.bind(this),settings.arr))}},{key:"softDrop",value:function(){var e=this.player;e.piece.checkCollision(1)||(clearInterval(e.piece.interval),e.piece.interval=setInterval(e.piece.doGravity.bind(e.piece),settings.gravity),e.piece.y++,e.piece.y>e.piece.lowestLine&&(e.piece.lowestLine=e.piece.y,e.piece.rotationLimit=0,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1),e.tspinRotate=!1,e.piece.lockdown(),e.piece.update())}},{key:"rotateLeft",value:function(){var e=this.player;e.piece.canRotate(-1)&&(e.piece.rotationLimit++,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,e.piece.angle--,e.piece.angle<0&&(e.piece.angle=3),e.tspinRotate=!0,e.piece.lockdown(),e.piece.update())}},{key:"rotateHalf",value:function(){var e=this.player;e.piece.canRotate(2)&&(e.piece.rotationLimit++,clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,e.piece.angle+=2,e.piece.angle>3&&(e.piece.angle-=4),e.tspinRotate=!0,e.piece.lockdown(),e.piece.update())}},{key:"hardDrop",value:function(){for(var e=this.player;!e.piece.checkCollision(1);)e.tspinRotate=!1,e.piece.y++;e.piece.update(),e.piece.die()}},{key:"spawnPiece",value:function(e){var t,a,i=this.player;if(void 0===e){null==this.bag[i.currentBag+1]&&this.newBag();var o=this.bag[i.currentBag].split(",");i.currentPieceName=o[i.currentPiece],i.currentPiece++,i.currentPiece>=7&&(i.currentPiece=0,i.currentBag++)}a=this.getPieceRotation(i.currentPieceName),t=this.getPieceNumber(i.currentPieceName),i.piece=new r(i,3,-1,i.currentPieceName,t,a),i.pressed.softDrop>0&&(i.piece.checkCollision(1)||(clearInterval(i.piece.interval),i.piece.interval=setInterval(i.piece.doGravity.bind(i.piece),settings.gravity))),i.piece.checkCollision(1)||(i.piece.y++,i.piece.y>i.piece.lowestLine&&(i.piece.lowestLine=i.piece.y,i.rotationLimit=0,clearTimeout(i.piece.lockDownTimer))),i.piece.update(),void 0===e&&(i.canHold||i.firstHold?i.canHold=!0:i.firstHold=!0)}},{key:"hold",value:function(){var e=this.player;console.log(e),e.canHold&&(e.firstHold?(e.canHold=!1,e.currentHoldPiece=[e.currentPieceName,e.currentPieceName=e.currentHoldPiece][0],clearInterval(e.piece.interval),clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,this.spawnPiece("hold")):(e.canHold=!1,e.currentHoldPiece=e.currentPieceName,clearInterval(e.piece.interval),clearTimeout(e.piece.lockDownTimer),e.piece.lockDownTimer=!1,this.spawnPiece()))}},{key:"clearLines",value:function(){for(var e=this.player,t=0,a=game.checkTspin(),i=21;i>=0;i--){for(var r=0,o=0;o<=9;o++)0!==e.boardPosition[o][i]&&r++;if(10==r){for(t++,o=0;o<=9;o++)0!==e.boardPosition[o][i]&&(e.boardPosition[o][i]=0);for(var n=i;n>=0;n--)for(var c=0;c<=9;c++)e.boardPosition[c][n]=0!=n?e.boardPosition[c][n-1]:0;i++}}t>0?e.combo++:(e.combo=0,game.applyGarbage()),game.linesSent(t,a),e.tspinRotate=!1}},{key:"checkTspin",value:function(){var e=this.player;if("T"==e.currentPieceName){var t,a=[!1,!1,!1,!1];if(!e.tspinRotate)return"not";if(e.boardPosition[e.piece.x+0][e.piece.y+1])(t=0-e.piece.angle)<0&&(t=4+t),a[t]=!0;if(e.boardPosition[e.piece.x+2][e.piece.y+1])(t=1-e.piece.angle)<0&&(t=4+t),a[t]=!0;if(e.boardPosition[e.piece.x+2][e.piece.y+3])(t=2-e.piece.angle)<0&&(t=4+t),a[t]=!0;if(e.boardPosition[e.piece.x+0][e.piece.y+3])a[t=3-e.piece.angle]=!0;return a[0]&&a[1]&&(a[2]||a[3])?"tspin":a[2]&&a[3]&&(a[1]||a[0])?"mini":"not"}return"not"}},{key:"linesSent",value:function(e,t){var a=this.player,i="",r=0;switch(a.combo){case 0:case 1:break;case 2:case 3:case 4:r+=1;break;case 5:case 6:r+=2;break;case 7:case 8:r+=3;break;case 9:case 10:case 11:r+=4;break;case 12:default:r+=5}i="Combo: "+a.combo.toString()+"<BR>";for(var o=21;o>=18;o--){for(var n=0,c=0;c<=9;c++)""!=a.boardPosition[c][o]&&n++;if(0!=n&&10!=n)break;18==o&&(r+=10,i+="PERFECT CLEAR!!!!!!!!!!!!!<BR>",a.b2b=!1)}if(r<=5)if(1==a.b2b&&4==e)r+=6,i+="Back to back TETRIS!!!<BR>";else if(1==a.b2b&&"not"!=t)switch(t){case"mini":r+=2,i+="Back to back T-spin mini!!!<BR>";break;case"tspin":switch(e){case 1:r+=3,i+="Back to back T-spin single!!!<BR>";break;case 2:r+=6,i+="Back to back T-spin double!!!<BR>";break;case 3:r+=9,i+="Back to back T-spin triple!!!<BR>"}}else{switch(e){case 1:a.b2b=!1,i+="single<BR>";break;case 2:r+=1,a.b2b=!1,i+="double!<BR>";break;case 3:r+=2,a.b2b=!1,i+="Triple!!<BR>";break;case 4:r+=4,i+="Tetris!!!!!<BR>",a.b2b=!0}switch(t){case"mini":e>0&&(r+=1,a.b2b=!0),i+="T-spin mini<BR>";break;case"tspin":switch(e){case 1:r+=2,i+="T-spin single!<BR>";break;case 2:r+=3,i+="T-spin double!!!<BR>";break;case 3:r+=4,i+="T-spin triple!!!!!<BR>"}a.b2b=!0}}a.linesSent+=r,e>0&&game.recordLinesSent(r),i+="lines sent: "+r+"<br>";i+="total lines sent: "+a.linesSent;r=a.reduceGarbage(r),console.log(r),r>0&&socket.emit("linesSent",r),document.getElementById("line").innerHTML=i}},{key:"losingGray",value:function(){for(var e=game.player,t=0;t<=21;t++)for(var a=0;a<=9;a++)0!=e.boardPosition[a][t]&&(e.boardPosition[a][t]=8);game.draw()}},{key:"clean",value:function(){var e=this.player;clearInterval(e.piece.interval)}},{key:"applyGarbage",value:function(){var e=this.player,t=!0,a=!1,i=void 0;try{for(var r,o=e.incoming[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var n=r.value;game.addGarbage(n)}}catch(e){a=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}e.incoming=[]}},{key:"newBag",value:function(){var e=this.bag.length;this.bag[e]=["S","Z","I","T","J","L","O"],this.shuffleBag(this.bag[e]),this.bag[e]=this.bag[e].join(",")}},{key:"shuffleBag",value:function(e){for(var t,a,i=e.length;0!==i;)a=Math.floor(Math.random()*i),t=e[i-=1],e[i]=e[a],e[a]=t;return e}},{key:"getPieceNumber",value:function(e){switch(e){case"S":return 1;case"Z":return 2;case"I":return 3;case"T":return 4;case"J":return 5;case"L":return 6;case"O":return 7;default:console.log("no such piece available")}}},{key:"getPieceRotation",value:function(e){switch(e){case"S":return["1,1|2,1|0,2|1,2","1,1|1,2|2,2|2,3","1,2|2,2|0,3|1,3","0,1|0,2|1,2|1,3"];case"Z":return["0,1|1,1|1,2|2,2","2,1|1,2|2,2|1,3","0,2|1,2|1,3|2,3","1,1|0,2|1,2|0,3"];case"I":return["0,1|1,1|2,1|3,1","2,0|2,1|2,2|2,3","0,2|1,2|2,2|3,2","1,0|1,1|1,2|1,3"];case"T":return["1,1|0,2|1,2|2,2","1,1|1,2|2,2|1,3","0,2|1,2|2,2|1,3","1,1|0,2|1,2|1,3"];case"J":return["0,1|0,2|1,2|2,2","1,1|2,1|1,2|1,3","0,2|1,2|2,2|2,3","1,1|1,2|0,3|1,3"];case"L":return["2,1|0,2|1,2|2,2","1,1|2,3|1,2|1,3","0,2|1,2|2,2|0,3","1,1|1,2|0,1|1,3"];case"O":return["1,1|1,2|2,1|2,2","1,1|1,2|2,1|2,2","1,1|1,2|2,1|2,2","1,1|1,2|2,1|2,2"];default:console.log("no such piece available")}}},{key:"shadeColor",value:function(e,t){var a=parseInt(e.slice(1),16),i=t<0?0:255,r=t<0?-1*t:t,o=a>>16,n=a>>8&255,c=255&a;return"#"+(16777216+65536*(Math.round((i-o)*r)+o)+256*(Math.round((i-n)*r)+n)+(Math.round((i-c)*r)+c)).toString(16).slice(1)}},{key:"getPieceColor",value:function(e){switch(e){case 1:return"#69BE28";case 2:return"#ED2939";case 3:return"#009FDA";case 4:return"#952D98";case 5:return"#0065BD";case 6:return"#FF7900";case 7:return"#FECB00";case 8:return"#696969"}}},{key:"draw",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var e=this.player,t=[],a=e.currentPiece,i=e.currentBag,r=0;r<4;r++){var o=this.bag[i].split(",");t.push(o[a]),++a>=7&&(a=0,i++)}var n={id:e.id,ghost:{y:e.piece.ghost.y,color:e.piece.ghost.color},piece:{rotation:e.piece.rotations[e.piece.angle],x:e.piece.x,y:e.piece.y,color:e.piece.color},boardPosition:e.boardPosition,hold:e.currentHoldPiece,queue:t,incoming:e.getTotalIncoming()};socket.emit("update",n),draw.clearCanvas(draw.boardCanvas),draw.drawGrid(draw.boardCanvas,24);var c=n.piece.rotation.split("|");draw.clearCanvas(draw.boardCanvas);for(r=0;r<=3;r++){h=c[r].split(","),s=Number(h[0]),l=Number(h[1]),draw.makeBlock(1+24*n.piece.x,1+24*n.ghost.y,s,l,n.ghost.color,draw.boardCanvas,24)}c=n.piece.rotation.split("|");for(r=0;r<=3;r++){var s,l,h;h=c[r].split(","),s=Number(h[0]),l=Number(h[1]),color=draw.getPieceColor(n.piece.color),draw.makeBlock(1+24*n.piece.x,1+24*n.piece.y,s,l,color,draw.boardCanvas,24)}draw.drawBoard(draw.boardCanvas,n.boardPosition,24),draw.drawHold(n.hold),draw.drawQueue(n.queue),draw.drawIncoming(n.incoming)})},{key:"recordBoardPosition",value:function(){for(var e=this.player,t="",a=0;a<=21;a++)for(var i=0;i<=9;i++)e.boardPosition[i][a]>0&&(t+=e.boardPosition[i][a]),t+=".";t+=","+((new Date).getTime()-e.startTime)+"|",e.boardPositionRecord+=t}},{key:"recordLinesSent",value:function(e){var t=this.player,a="";a+=e.toString()+",",a+=(new Date).getTime()-t.startTime+"|",t.linesSentRecord+=a}},{key:"addGarbage",value:function(e){for(var t=this.player,a=Math.floor(10*Math.random()),i=0;i<=20;i++)for(var r=0;r<=9;r++)t.boardPosition[r][i]=t.boardPosition[r][i+e];for(i=0;i<e;i++){for(r=0;r<=9;r++)t.boardPosition[r][21-i]=8;t.boardPosition[a][21-i]=0}t.piece.update()}},{key:"applyGarbage",value:function(){var e=this.player;if(void 0!==e.incoming.length){var t=!0,a=!1,i=void 0;try{for(var r,o=e.incoming[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var n=r.value;game.addGarbage(n)}}catch(e){a=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(a)throw i}}e.incoming=[]}}}])&&i(t.prototype,a),n&&i(t,n),e}();window.game=new n},function(e,t,a){function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=a(5),o=function(){function e(t,a,i,o,n,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.x=a,this.y=i,this.pieceName=o,this.color=n,this.angle=0,this.oldX=[0,0,0,0],this.oldY=[0,0,0,0],this.rotations=c,this.lowestLine=0,this.rotationLimit=0,this.interval=setInterval(this.doGravity.bind(this),1e3),this.lockDownTimer=!1;n=game.getPieceColor(n);this.ghost=new r(t,this,n)}var t,a,o;return t=e,(a=[{key:"update",value:function(){this.ghost.update(),game.draw()}},{key:"doGravity",value:function(){this.checkCollision(1)||(this.y++,this.y>this.lowestLine&&(this.lowestLine=this.y,this.rotationLimit=0,clearTimeout(this.lockDownTimer),this.lockDownTimer=!1),this.player.tspinRotate=!1),this.lockdown(),this.update()}},{key:"draw",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var e=this.rotations[this.angle].split("|"),t=0;t<=3;t++){var a,i,r;r=e[t].split(","),a=Number(r[0]),i=Number(r[1]),color=game.getPieceColor(this.color),draw.makeBlock(1+24*this.x,1+24*this.y,a,i,color,tetrisBoard.canvas)}game.drawBoard()})},{key:"lockdown",value:function(e){this.checkCollision(1)?this.rotationLimit>15?this.die():this.lockDownTimer||(this.lockDownTimer=setTimeout(this.die.bind(this),500)):(clearTimeout(this.lockDownTimer),this.lockDownTimer=!1)}},{key:"die",value:function(){if(this.checkCollision(1)){clearInterval(this.interval),clearTimeout(this.lockDownTimer),this.lockDownTimer=!1;for(var e=this.rotations[this.angle].split("|"),t=0;t<=3;t++){var a,i,r;r=e[t].split(","),a=Number(r[0]),i=Number(r[1]),this.player.boardPosition[this.x+a][this.y+i]=this.color}game.clearLines(),game.recordBoardPosition(),game.checkLoss()?(console.log("YOU FUCKING LOST"),game.losingGray()):game.spawnPiece()}}},{key:"checkCollision",value:function(e){for(var t=this.rotations[this.angle].split("|"),a=0;a<=3;a++){var i=0,r=0,o=t[a].split(","),n=Number(o[0]),c=Number(o[1]);switch(e){case 0:i=1;break;case 1:r=1;break;case 2:i=-1;break;case 3:r=-1;break;default:console.log("no such direction")}if(this.x+n+i<0||this.x+n+i>9||this.y+c+r<0||this.y+c+r>21)return!0;if(0!==this.player.boardPosition[this.x+n+i][this.y+c+r])return!0}return!1}},{key:"canRotate",value:function(e){var t;(t=this.angle+e)<0&&(t+=4),t>3&&(t-=4);for(var a=0;a<=4;a++){var i,r;if("I"===this.player.currentPieceName){if(0===this.angle&&1===e||3===this.angle&&-1===e||1===this.angle&&-1===e||2===this.angle&&1===e)switch(a){case 0:i=0,r=0;break;case 1:i=-2,r=0;break;case 2:i=1,r=0;break;case 3:i=-2,r=1;break;case 4:i=1,r=-2}if((1===this.angle&&-1===e||2===this.angle&&1===e)&&(i*=-1,r*=-1),1===this.angle&&1===e||0===this.angle&&-1===e||2===this.angle&&-1===e||3===this.angle&&1===e)switch(a){case 0:i=0,r=0;break;case 1:i=-1,r=0;break;case 2:i=2,r=0;break;case 3:i=-1,r=-2;break;case 4:i=2,r=1}(2===this.angle&&-1===e||3===this.angle&&1===e)&&(i*=-1,r*=-1)}else{if(0===this.angle&&1===e||2===this.angle&&-1===e||1===this.angle&&-1===e||1===this.angle&&1===e)switch(a){case 0:i=0,r=0;break;case 1:i=-1,r=0;break;case 2:i=-1,r=-1;break;case 3:i=-2,r=2;break;case 4:i=-1,r=2}if((1===this.angle&&-1===e||1===this.angle&&1===e)&&(i*=-1,r*=-1),2===this.angle&&1===e||0===this.angle&&-1===e||3===this.angle&&-1===e||3===this.angle&&1===e)switch(a){case 0:i=0,r=0;break;case 1:i=1,r=0;break;case 2:i=1,r=-1;break;case 3:i=0,r=2;break;case 4:i=1,r=2}(3===this.angle&&-1===e||3===this.angle&&1===e)&&(i*=-1,r*=-1)}for(var o=0,n=this.rotations[t].split("|"),c=0;c<=3;c++){var s=n[c].split(","),l=Number(s[0]),h=Number(s[1]);if(this.x+l+i<0||this.x+l+i>9||this.y+h+r<0||this.y+h+r>21)break;if(0===this.player.boardPosition[this.x+l+i][this.y+h+r]&&4==++o)return this.x+=i,this.y+=r,!0}}return!1}}])&&i(t.prototype,a),o&&i(t,o),e}();e.exports=o},function(e,t){function a(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(t,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.piece=a,this.color=game.shadeColor(i,-.5),this.pieceName=t.currentPieceName,this.angle=a.angle,this.rotations=a.rotations[a.angle]}var t,i,r;return t=e,(i=[{key:"update",value:function(){for(this.x=this.piece.x,this.y=this.piece.y,this.angle=this.piece.angle,this.rotations=this.piece.rotations[this.piece.angle];!this.checkDown();)this.y++}},{key:"checkDown",value:function(){for(var e=this.rotations.split("|"),t=0;t<=3;t++){var a=e[t].split(","),i=Number(a[0]),r=Number(a[1]);if(this.x+i<0||this.x+i>9||this.y+r+1<0||this.y+r+1>21)return!0;if(0!==this.player.boardPosition[this.x+i][this.y+r+1])return!0}return!1}}])&&a(t.prototype,i),r&&a(t,r),e}();e.exports=i},function(e,t){},function(e,t){window.addEventListener("keyup",function(e){key.onKeyUp(e)},!1),window.addEventListener("keydown",function(e){key.onKeyDown(e)},!1),window.key={moveLeft:37,rotateRight:38,moveRight:39,softDrop:40,rotateLeft:17,rotateRightMac:91,hardDrop:32,hold:16,rotateHalf:90,rotateHalf2:65,onKeyDown:function(e){window.dokeydown(e.keyCode)},onKeyUp:function(e){window.dokeyup(e.keyCode)}},window.dokeydown=function(e){var t=window.game,a=window.game.player,i="";switch(e){case key.rotateLeft:i="rotateLeft";break;case key.rotateRightMac:i="rotateRight";break;case key.moveLeft:i="moveLeft";break;case key.hardDrop:i="hardDrop";break;case key.hold:i="hold";break;case key.rotateRight:i="rotateRight";break;case key.moveRight:i="moveRight";break;case key.softDrop:i="softDrop";break;case key.rotateHalf:case key.rotateHalf2:i="rotateHalf"}switch(i){case"moveLeft":a.isPressed("moveLeft")&&t.moveLeft(a);break;case"rotateRight":a.isPressed("rotateRight")&&t.rotateRight(a);break;case"moveRight":a.isPressed("moveRight")&&t.moveRight(a);break;case"softDrop":a.isPressed("softDrop")&&t.softDrop(a);break;case"rotateLeft":a.isPressed("rotateLeft")&&t.rotateLeft(a);break;case"rotateHalf":a.isPressed("rotateHalf")&&t.rotateHalf(a);break;case"hardDrop":a.isPressed("hardDrop")&&t.hardDrop(a);break;case"hold":a.isPressed("hold")&&(a.tspinRotate=!1,t.hold(a))}a.pressed[i]=(new Date).getTime()},window.dokeyup=function(e){window.game;var t=window.game.player,a="";switch(e){case key.rotateLeft:a="rotateLeft";break;case key.rotateRightMac:a="rotateRight";break;case key.moveLeft:a="moveLeft";break;case key.hardDrop:a="hardDrop";break;case key.hold:a="hold";break;case key.rotateRight:a="rotateRight";break;case key.moveRight:a="moveRight";break;case key.softDrop:a="softDrop";break;case key.rotateHalf:case key.rotateHalf2:a="rotateHalf"}delete t.pressed[a]}},function(e,t){window.draw={queueCanvas:document.getElementById("queueCanvas"),holdCanvas:document.getElementById("holdCanvas"),boardCanvas:document.getElementById("boardCanvas"),playerIncomingCanvas:document.getElementById("playerIncomingCanvas"),makeBlock:function(e,t,a,i,r,o,n){o!=draw.holdCanvas&&o!=draw.queueCanvas&&(i-=2);var c=o.getContext("2d");c.fillStyle=r,c.fillRect(e+a*n,t+i*n,n,n),c.beginPath(),c.rect(e+a*n,t+i*n,n,n),c.stroke(),c.globalAlpha=1},drawS:function(e,t,a,i){this.makeBlock(e,t,2,1,"#69BE28",a,i),this.makeBlock(e,t,1,1,"#69BE28",a,i),this.makeBlock(e,t,1,2,"#69BE28",a,i),this.makeBlock(e,t,0,2,"#69BE28",a,i)},drawZ:function(e,t,a,i){this.makeBlock(e,t,0,1,"#ED2939",a,i),this.makeBlock(e,t,1,1,"#ED2939",a,i),this.makeBlock(e,t,1,2,"#ED2939",a,i),this.makeBlock(e,t,2,2,"#ED2939",a,i)},drawI:function(e,t,a,i){this.makeBlock(e,t,0,1,"#009FDA",a,i),this.makeBlock(e,t,1,1,"#009FDA",a,i),this.makeBlock(e,t,2,1,"#009FDA",a,i),this.makeBlock(e,t,3,1,"#009FDA",a,i)},drawT:function(e,t,a,i){this.makeBlock(e,t,1,1,"#952D98",a,i),this.makeBlock(e,t,0,2,"#952D98",a,i),this.makeBlock(e,t,1,2,"#952D98",a,i),this.makeBlock(e,t,2,2,"#952D98",a,i)},drawJ:function(e,t,a,i){this.makeBlock(e,t,0,1,"#0065BD",a,i),this.makeBlock(e,t,0,2,"#0065BD",a,i),this.makeBlock(e,t,1,2,"#0065BD",a,i),this.makeBlock(e,t,2,2,"#0065BD",a,i)},drawL:function(e,t,a,i){this.makeBlock(e,t,2,1,"#FF7900",a,i),this.makeBlock(e,t,0,2,"#FF7900",a,i),this.makeBlock(e,t,1,2,"#FF7900",a,i),this.makeBlock(e,t,2,2,"#FF7900",a,i)},drawO:function(e,t,a,i){this.makeBlock(e,t,1,1,"#FECB00",a,i),this.makeBlock(e,t,1,2,"#FECB00",a,i),this.makeBlock(e,t,2,1,"#FECB00",a,i),this.makeBlock(e,t,2,2,"#FECB00",a,i)},clearCanvas:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)},drawPlayerIncoming:function(){draw.clearCanvas(draw.playerIncomingCanvas);var e=draw.playerIncomingCanvas.getContext("2d");e.fillStyle="red";var t=player.getTotalIncoming();t>22?e.fillRect(0,1,4,draw.playerIncomingCanvas.height):e.fillRect(0,1+draw.playerIncomingCanvas.height-t*width,4,1+draw.playerIncomingCanvas.height-t*width)},drawGrid:function(e,t){this.blockWidth=t,e.width=10*this.blockWidth+2,e.height=20*this.blockWidth+2,this.context=e.getContext("2d");for(var a=1;a<=e.width;a+=this.blockWidth)this.context.moveTo(a,0),this.context.lineTo(a,e.height);for(var i=1;i<=e.height;i+=this.blockWidth)this.context.moveTo(0,i),this.context.lineTo(e.width,i);this.context.strokeStyle="black",this.context.stroke();var r=e.toDataURL();e.style.backgroundImage="url("+r+")"},otherPlayerCanvas:[]}},function(e,t){window.draw.getPieceColor=function(e){switch(e){case 1:return"#69BE28";case 2:return"#ED2939";case 3:return"#009FDA";case 4:return"#952D98";case 5:return"#0065BD";case 6:return"#FF7900";case 7:return"#FECB00";case 8:return"#696969"}}},function(e,t){window.shadeColor=function(e,t){var a=parseInt(e.slice(1),16),i=t<0?0:255,r=t<0?-1*t:t,o=a>>16,n=a>>8&255,c=255&a;return"#"+(16777216+65536*(Math.round((i-o)*r)+o)+256*(Math.round((i-n)*r)+n)+(Math.round((i-c)*r)+c)).toString(16).slice(1)}},function(e,t){window.draw.drawBoard=function(e,t,a){for(var i=2;i<=21;i++)for(var r=0;r<=9;r++)if(0!==t[r][i]){var o=draw.getPieceColor(t[r][i]);o=shadeColor(o,-.15),draw.makeBlock(1+r*a,1+i*a,0,0,o,e,a)}}},function(e,t){window.draw.drawHold=function(e){switch(draw.clearCanvas(draw.holdCanvas,24),e){case"S":draw.drawS(1,1,draw.holdCanvas,24);break;case"Z":draw.drawZ(1,1,draw.holdCanvas,24);break;case"I":draw.drawI(1,1,draw.holdCanvas,24);break;case"T":draw.drawT(1,1,draw.holdCanvas,24);break;case"J":draw.drawJ(1,1,draw.holdCanvas,24);break;case"L":draw.drawL(1,1,draw.holdCanvas,24);break;case"O":draw.drawO(1,1,draw.holdCanvas,24);break;case"":break;default:console.log("no such piece available")}}},function(e,t){window.draw.drawQueue=function(e){draw.clearCanvas(draw.queueCanvas,24);for(var t=0;t<=3;t++)switch(e[t]){case"S":draw.drawS(1,96*t+1,draw.queueCanvas,24);break;case"Z":draw.drawZ(1,96*t+1,draw.queueCanvas,24);break;case"I":draw.drawI(1,96*t+1,draw.queueCanvas,24);break;case"T":draw.drawT(1,96*t+1,draw.queueCanvas,24);break;case"J":draw.drawJ(1,96*t+1,draw.queueCanvas,24);break;case"L":draw.drawL(1,96*t+1,draw.queueCanvas,24);break;case"O":draw.drawO(1,96*t+1,draw.queueCanvas,24);break;default:console.log("no such piece available")}}},function(e,t){window.draw.drawIncoming=function(e){draw.clearCanvas(draw.playerIncomingCanvas);var t=draw.playerIncomingCanvas.getContext("2d");t.fillStyle="red",e>22?t.fillRect(0,1,4,draw.playerIncomingCanvas.height):t.fillRect(0,1+draw.playerIncomingCanvas.height-24*e,4,1+draw.playerIncomingCanvas.height-24*e)}},function(e,t,a){"use strict";a.r(t);a(2),a(3),a(0),a(7),a(8),a(9),a(10),a(11),a(12),a(13),a(14)}]);